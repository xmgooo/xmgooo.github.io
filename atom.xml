<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>xmgooo</title>
  
  <subtitle>take it easy</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-11-10T12:41:49.000Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>xiemao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Fastdfs分布式文件存储</title>
    <link href="http://yoursite.com/2018/11/10/Fastdfs%E5%88%86%E5%B8%83%E5%BC%8F%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8/"/>
    <id>http://yoursite.com/2018/11/10/Fastdfs分布式文件存储/</id>
    <published>2018-11-10T09:09:30.000Z</published>
    <updated>2018-11-10T12:41:49.000Z</updated>
    
    <content type="html"><![CDATA[<h1>Fastdfs分布式文件存储</h1><hr><h2>简介</h2><p>     Fastdfs是一款比较轻量级的开源分布式文件系统，作者是余庆大大在0几年业余时间用c撸出来的(工作不饱和，加班不够啊:)  ，现任淘宝网开放平台技术部资深架构师,Fastdfs在小文件存储方面性能优异，在淘宝和京东都有实例的应用案例，去哪儿目前使用的是seaweedfs，基于Facebook的图片存储论文用go语言开发的一套存储系统，使用起来也是非常方便，相比Fastdfs更加现代化，这个日后研究，直接进入正题。&lt;!--more--&gt;</p><h2>相关术语</h2><p>• Tracker Server：跟踪服务器，主要负责任务调度,请求分发负载的工作。记录storage server的状态，是连接Client和Storage server的枢纽。• Storage Server：存储服务器，文件和meta data都保存到存储服务器上。• group：组，也可称为卷。同组内服务器上的文件是完全相同的。• 文件标识：包括两部分：组名和文件名（包含路径）。• meta data：文件相关属性，键值对（Key Value Pair）方式，如：width=1024,heigth=768</p><h2>系统架构</h2><p><img src="/2018/11/10/Fastdfs分布式文件存储/1.jpg" alt="1.jpg"></p><p>从图中可以看出两大核心部分，trakcer跟踪器，storage存储节点，跟踪器主要负责路由分发，任务调度，与clent端直接交互，storage则负责存储实际的数据，两部分都支持主流的分布式主从配置，即master/slave模式，在请求量大时可加大trakcer集群规模，在存储大文件或读写频繁时可加大storage集群规模，非常容易的就能做到局部和全局的横向扩展，如果对这两部分理解还很模糊我们看下文件上传下载的流程图</p><p><img src="/2018/11/10/Fastdfs分布式文件存储/2.jpg" alt="2.jpg">• 1. client询问tracker上传到的storage，不需要附加参数；• 2.tracker返回一台可用的storage；• 3.client直接和storage通讯完成文件上传。</p><p><img src="/2018/11/10/Fastdfs分布式文件存储/3.jpg" alt="3.jpg">• 1. client询问tracker下载文件的storage，参数为文件标识（组名和文件名）；• 2.tracker返回一台可用的storage；• 3.client直接和storage通讯完成文件下载。</p><h2>同步机制</h2><p>•同一组内的storage server之间是对等的，文件上传、删除等操作可以在任意一台storage server上进行；•文件同步只在同组内的storage server之间进行，采用push方式，即源服务器同步给目标服务器；•源头数据才需要同步，备份数据不需要再次同步，否则就构成环路了；•上述第二条规则有个例外，就是新增加一台storage server时，由已有的一台storage server将已有的所有数据（包括源头数据和备份数据）同步给该新增服务器，当某台master storage宕机时，依据选举算法此master节点下的某台slave storage会自动切换为master，并将原master剔除集群，原master重启后，会自动以slave的角色重新加入集群，并在重启后将宕机期间的数据自动同步到此节点上。</p><h2>文件目录结构</h2><p><img src="/2018/11/10/Fastdfs分布式文件存储/4.jpg" alt="4.jpg"><img src="/2018/11/10/Fastdfs分布式文件存储/5.jpg" alt="5.jpg"></p><h2>运行与安装（单节点）</h2><p>一、准备工作(俩台机器同时进行)<br>1.下载软件: http://sourceforge.net/projects/fastdfs/files/<br>2安装gcc。命令:yum install make cmake gcc gcc-c++</p><p>3 安装libfastcommon(俩台机器同时进行)<br>  3.1 上传libfastcommon-master.zip到/usr/local/software下<br>  3.2 进行解压libfastcommon-master.zip:<br>命令:unzip libfastcommon-master.zip -d /usr/local/fast/<br>  3.3 进入目录:cd /usr/local/fast/libfastcommon-master/<br><img src="/2018/11/10/Fastdfs分布式文件存储/6.jpg" alt="6.jpg"></p><p>4 进行编译和安装:<br>命令:  ./make.sh<br>命令:  ./make.sh install<br><img src="/2018/11/10/Fastdfs分布式文件存储/7.jpg" alt="7.jpg">注意安装的路径:也就是说,我们的libfastcommon默认安装到了/usr/lib64/这个位置。</p><p>5 进行软件创建。FastDFS主程序设置的目录为/usr/local/lib/,所以我们需要创建/usr/lib64/下的一些核心执行程序的软连接文件。<br>命令:mk dir /usr/local/lib/<br>命令:ln -s /usr/lib64/libfastcommon.so /usr/local/lib/libfastcommon.so<br><img src="/2018/11/10/Fastdfs分布式文件存储/8.jpg" alt="8.jpg">命令:ln -s /usr/lib64/libfastcommon.so /usr/lib/libfastcommon.so<br>命令:ln -s /usr/lib64/libfdfsclient.so /usr/local/lib/libfdfsclient.so<br>命令:ln -s /usr/lib64/libfdfsclient.so /usr/lib/libfdfsclient.so<br>6、安装FastDFS<br>  6.1 进入到cd /usr/local/software下,解压FastDFS_v5.05.tar.gz文件<br>  命令:cd /usr/local/software<br>  命令:tar -zxvf FastDFS_v5.05.tar.gz -C /usr/local/fast/<br>  6.2安装编译<br>  命令:cd /usr/local/fast/FastDFS/<br>  编译命令:./make.sh<br>  安装命令:./make.sh install<br><img src="/2018/11/10/Fastdfs分布式文件存储/9.jpg" alt="9.jpg">7 采用默认安装方式脚本文件说明:<br>1、服务脚本在:<br>/etc/init.d/fdfs_storaged<br>/etc/init.d/fdfs_trackerd<br><img src="/2018/11/10/Fastdfs分布式文件存储/10.jpg" alt="10.jpg">2、配置文件在:<br>/etc/fdfs/client.conf.sample<br>/etc/fdfs/storage.conf.sample<br>/etc/fdfs/tracker.conf.sample<br><img src="/2018/11/10/Fastdfs分布式文件存储/11.jpg" alt="11.jpg">3、命令行工具在/usr/bin/目录下Fdfs_*的一些列执行脚本<img src="/2018/11/10/Fastdfs分布式文件存储/12.jpg" alt="12.jpg">4 因为FastDFS服务脚本设置的bin目录为/usr/local/bin/下,但是实际我们安装在了/usr/bin/下面。所以我们需要修改FastDFS配置文件中的路径,也就是需要修改俩个配置文件:<br>命令:vim /etc/init.d/fdfs_storaged<br>进行全局替换命令:%s+/usr/local/bin+/usr/bin<br>命令:vim /etc/init.d/fdfs_trackerd<br>进行全局替换命令:%s+/usr/local/bin+/usr/bin<br>4、配置跟踪器(192.168.1.172节点)<br>1进入cd/etc/fdfs/目录配置跟踪器文件(注意是192.168.1.172节点),把tracker.conf.sample文件进行cope一份:去修改tracker.conf文件<img src="/2018/11/10/Fastdfs分布式文件存储/13.jpg" alt="13.jpg"></p><p>2 修改tracker.conf文件<br>命令:vim /etc/fdfs/tracker.conf<br>如下图所示:我们暂时修改配置文件里的base_path即可。<br><img src="/2018/11/10/Fastdfs分布式文件存储/14.jpg" alt="14.jpg"></p><p>修改为自己的路径地址:base_path=/fastdfs/tracker<br>注意:对于tracker.conf配置文件参数解释可以找官方文档,地址为:<br>http://bbs.chinaunix.net/thread-1941456-1-1.html<br>3 最后我们一定要创建之前定义好的目录(也就是/fastdfs/tracker):<br>命令:mkdir -p /fastdfs/tracker<br>4 关闭防火墙:(我们在学习时可以不用考虑防火墙的问题)<br>vim /etc/sysconfig/iptables<br>添加:-A INPUT -m state --state NEW -m tcp -p tcp --dport 22122 -j ACCEPT<br>重启:service iptables restart<br>5 启动跟踪器<br>如图所示:<br><img src="/2018/11/10/Fastdfs分布式文件存储/15.jpg" alt="15.jpg"></p><p>目录命令:cd /fastdfs/tracker/ &amp;&amp; ll<br>启动tracker命令:/etc/init.d/fdfs_trackerd start<br>查看进程命令:ps -el | grep fdfs<br>停止tracker命令:/etc/init.d/fdfs_trackerd stop</p><p>6可以设置开机启动跟踪器:(一般生产环境需要开机启动一些服务,如keepalived、linux、tomcat等等)<br>命令:vim /etc/rc.d/rc.local<br>加入配置:/etc/init.d/fdfs_trackerd start</p><p>5、配置FastDFS存储(192.168.1.173)<br>1 进入文件目录:cd /etc/fdfs/,进行copy storage文件一份<br>命令:cd /etc/fdfs/<br>命令:cp storage.conf.sample storage.conf<br>2 修改storage.conf文件<br>命令:vim /etc/fdfs/storage.conf<br>修改内容:<br>base_path=/fastdfs/storage<br>store_path0=/fastdfs/storage<br>tracker_server=192.168.1.172:22122<br>http.server_port=8888<br>3 创建存储目录:mkdir -p /fastdfs/storage<br>4 打开防火墙:<br>命令:vim /etc/sysconfig/iptables<br>添加:-A INPUT -m state --state NEW -m tcp -p tcp --dport 23000 -j ACCEPT<br>重启:service iptables restart<br>5 启动存储(storage)<br>命令:/etc/init.d/fdfs_storaged start (关闭:/etc/init.d/fdfs_storaged stop)<br>(初次启动成功后会在/fastdbf/storage/ 目录下创建 data、logs俩个目录)<img src="/2018/11/10/Fastdfs分布式文件存储/16.jpg" alt="16.jpg">6 查看FastDFS storage 是否启动成功<br>命令:ps -ef | grep fdfs<img src="/2018/11/10/Fastdfs分布式文件存储/17.jpg" alt="17.jpg">并且我们进入到/fastdfs/storage/data/文件夹下会看到一些目录文件(256*256),如下:<br>命令:cd /fastdfs/storage/data/ &amp;&amp; ls<br><img src="/2018/11/10/Fastdfs分布式文件存储/18.jpg" alt="18.jpg">7 同理,也可以设置开机启动存储器:(一般生产环境需要开机启动一些服务,如keepalived、linux、tomcat等等)<br>命令:vim /etc/rc.d/rc.local<br>加入配置:/etc/init.d/fdfs_storaged start<br>到此为止我们的FastDFS环境已经搭建完成。。。</p><h2>验证环境</h2><p>1 我们先使用命令上传一个文件。注意:是在tracker(跟踪器)中上传。首先我们在跟踪器(192.168.1.172)里copy一份client.conf文件。<br>命令:cd /etc/fdfs/<br>命令:cp client.conf.sample client.conf<br><img src="/2018/11/10/Fastdfs分布式文件存储/19.jpg" alt="19.jpg"></p><p>2 编辑client.conf文件<br>命令:vim /etc/fdfs/client.conf<br>修改内容:<br>base_path=/fastdfs/tracker<br>tracker_server=192.168.1.172:22122<br>3 我们找到命令的脚本位置,并且使用命令,进行文件的上传:<br>命令:cd /usr/bin/<br>命令:ls | grep fdfs<br><img src="/2018/11/10/Fastdfs分布式文件存储/20.jpg" alt="20.jpg"></p><p>4 使用命令fdfs_upload_file进行上传操作:<br>首先,我们先看一下存储器(192.168.1.173),进入到data下,在进入00文件夹下,发现00文件夹下还有一堆文件夹,然后继续进入00文件夹下,最终我们所进入的文件夹为:<br>/fastdfs/storage/data/00/00 里面什么文件都没有。</p><p><img src="/2018/11/10/Fastdfs分布式文件存储/21.jpg" alt="21.jpg"></p><p>然后,我们进行上传操作,比如把之前的/usr/local/software/文件夹下的某一个文件上传到FastDFS系统中去,在跟踪器(192.168.1.172)中上传文件,命令如下:<br>命令:/usr/bin/fdfs_upload_file /etc/fdfs/client.conf<br>/usr/local/software/FastDFS_v5.05.tar.gz<br><img src="/2018/11/10/Fastdfs分布式文件存储/22.jpg" alt="22.jpg"></p><p>最后我们发现,命令执行完毕后,返回一个group1/M00/00/00/...的ID,其实就是返回当前所上传的文件在存储器(192.168.1.173)中的哪一个组、哪一个目录位置,所以我们查看存储器中的/fastdfs/storage/data/00/00文件夹位置,发现已经存在了刚才上传的文件,到此为止,我们的测试上传文件已经OK了。如下<br><img src="/2018/11/10/Fastdfs分布式文件存储/23.jpg" alt="23.jpg"></p><p>7、FastDFS与Nginx整合<br>1 首先两台机器里必须先安装nginx<br>2然后我们在存储节点上(192.168.1.173)安装fastdfs-nginx-module_v1.16.tar.gz包进行整合。<br><img src="/2018/11/10/Fastdfs分布式文件存储/24.jpg" alt="24.jpg"></p><p>目录命令:cd /usr/local/software/<br>解压命令:tar -zxvf /usr/local/software/fastdfs-nginx-module_v1.16.tar.gz -C /usr/local/fast/<br>3 进入目录:cd fastdfs-nginx-module/src/<br><img src="/2018/11/10/Fastdfs分布式文件存储/25.jpg" alt="25.jpg"></p><p>4 编辑配置文件config<br>命令: vim /usr/local/fast/fastdfs-nginx-module/src/config<br>修改内容:去掉下图中的local文件层次<br><img src="/2018/11/10/Fastdfs分布式文件存储/26.jpg" alt="26.jpg"></p><p>修改完毕为:<br><img src="/2018/11/10/Fastdfs分布式文件存储/27.jpg" alt="27.jpg"></p><p>5 FastDFS与nginx进行集成<br>首先把之前的nginx进行删除<br>目录命令:cd /usr/local/<br>删除命令:rm -rf nginx<br>进入到nginx目录命令:cd nginx-1.6.2/<br>加入模块命令:./configure --add-module=/usr/local/fast/fastdfs-nginx-module/src/<br>重新编译命令:make &amp;&amp; make install<br>6 复制fastdfs-ngin-module中的配置文件,到/etc/fdfs目录中,如图所示:<br><img src="/2018/11/10/Fastdfs分布式文件存储/28.jpg" alt="28.jpg"></p><p>copy命令:cp /usr/local/fast/fastdfs-nginx-module/src/mod_fastdfs.conf /etc/fdfs/<br>7 进行修改 /etc/fdfs/ 目录下,我们刚刚copy过来的mod_fastdfs.conf 文件。<img src="/2018/11/10/Fastdfs分布式文件存储/29.jpg" alt="29.jpg"></p><p>命令:vim /etc/fdfs/mod_fastdfs.conf修改内容:比如连接超时时间、跟踪器路径配置、url的group配置、connect_timeout=10tracker_server=192.168.1.172:22122<br>url_have_group_name = true<br>store_path0=/fastdfs/storage<br>8 复制FastDFS里的2个文件,到/etc/fdfs目录中,如图所示:<br><img src="/2018/11/10/Fastdfs分布式文件存储/30.jpg" alt="30.jpg"></p><p>目录命令:cd /usr/local/fast/FastDFS/conf/<br>Copy命令:cp http.conf mime.types /etc/fdfs/<br>9创建一个软连接,在/fastdfs/storage文件存储目录下创建软连接,将其链接到实际存放数据的目录。<br>命令:ln -s /fastdfs/storage/data/ /fastdfs/storage/data/M00<br>10 修改Nginx配置文件,如图所示:<br><img src="/2018/11/10/Fastdfs分布式文件存储/31.jpg" alt="31.jpg"></p><p>命令:vim nginx.conf修改配置内容如下图所示:<br><img src="/2018/11/10/Fastdfs分布式文件存储/32.jpg" alt="32.jpg"></p><p>修改内容为:<br>listen 8888;<br>server_name localhost;location ~/group([0-9])/M00 {<br>#alias /fastdfs/storage/data;<br>ngx_fastdfs_module;<br>}<br>注意:nginx里的端口要和第五步配置FastDFS存储中的storage.conf文件配置一致,也就是(http.server_port=8888)<br>11 最后检查防火墙,然后我们启动nginx服务<br><img src="/2018/11/10/Fastdfs分布式文件存储/33.jpg" alt="33.jpg"></p><p>启动命令:/usr/local/nginx/sbin/nginx,我们刚才上传了一个文件,上传成功,<br>如图:<br><img src="/2018/11/10/Fastdfs分布式文件存储/34.jpg" alt="34.jpg"></p><p>现在我们使用这个ID用浏览器访问地址:http://192.168.1.173:8888/group1/M00/00/00/wKgBrVaSvM6AddWWAAVFOL7FJU4.tar.gz我们就可以下载这个文件啦!如下图所示:<br><img src="/2018/11/10/Fastdfs分布式文件存储/35.jpg" alt="35.jpg"></p><p>运维注意:我们在使用FastDFS的时候,需要正常关机,不要使用kill -9强杀FastDFS进程,不然会在文件上传时出现丢数据的情况。到此,我们的FastDFS与Nginx整合完毕!!<br>八:启动停止服务步骤如下:<br>启动命令:<br>启动tracker命令:/etc/init.d/fdfs_trackerd start<br>查看进程命令:ps -el | grep fdfs<br>启动storage命令:/etc/init.d/fdfs_storaged start<br>查看进程命令:ps -el | grep fdfs<br>启动nginx命令:/usr/local/nginx/sbin/nginx停止命令:<br>停止tracker命令:/etc/init.d/fdfs_trackerd stop<br>关闭storage命令:/etc/init.d/fdfs_storaged  stop<br>关闭nginx命令:/usr/local/nginx/sbin/nginx -s stop</p><h2>集群环境安装</h2><p>集群环境安装我就稍微简略点了，99%是相同的，说下差异点，主要是一个group的区分，单节点tracker时没指定group，默认为group0<br>首先准备几台机器<br>192.168.1.113 track-group1<br>192.168.1.114 track-group2<br>192.168.1.115 storage-group1-1<br>192.168.1.116 storage-group1-2<br>192.168.1.117 storage-group2-1<br>192.168.1.118 storage-group2-2</p><p>创建tracker节点无区别，依葫芦画瓢创建storage节点时需要指明并区分当前storage节点是挂载在哪个tracker下group的概念主要是为了区分不同的数据来源，可能来自不能的系统，不同的应用，当然在文件传输时不指明group会依照nginx的负载均衡算法(轮询，权重等)分配group<br>eg: 115 116为group1  117 118为group2<br>vim storage.confgroup_name = group1(或group2)首先一定要启动tracker，之后启动storage，查看日志<img src="/2018/11/10/Fastdfs分布式文件存储/36.jpg" alt="36.jpg"><br>我们可以发现两个tracker是能互相知道对方的，更能知道当前tracker下挂载了多少个storage，此时storage集群中，拿115 116为例子，一个group中的数据永远是相同的，之间异步进行文件的备份，实现高可用，如果此时115宕机，115会被剔除出group1，恢复后从116进行文件的恢复，并再次加入集群ok,当我们系统中存在多个tracker集群时,此时tracker就不应该直接与客户端通信，在nginx网管层(多层nginx+keeplived虚拟出svip)进行负载均衡</p><h2>java客户端操作</h2><p>此处结合spring＋mybatis＋springmvc来进行操作，ssm的基本配置不需多说</p><ol><li><p>导入依赖,国产的，包里的代码都有详细的注释，一目了然<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.tobato&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastdfs-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.25.4-RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></p></li><li><p>添加springmvc中multipartFile的bean配置，此处可以进行文件类型，文件大小，文件编码等设置，不细说，网上一大把<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;multipartResolver&quot;</span><br><span class="line">      class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure></p></li><li><p>添加fastdfs客户端连接配置，主要是一些连接器，连接池的配置，也可以进行超时时间，签名验签token校验等，这里给出最进本的配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">       http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">       http://www.springframework.org/schema/context</span><br><span class="line">       http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--配置扫描包--&gt;</span><br><span class="line">    &lt;context:component-scan base-package=&quot;com.github.tobato.fastdfs.service,com.github.tobato.fastdfs.domain&quot;/&gt;</span><br><span class="line">    &lt;!--配置连接管理器--&gt;</span><br><span class="line">    &lt;bean id=&quot;trackerConnectionManager&quot; class=&quot;com.github.tobato.fastdfs.conn.TrackerConnectionManager&quot;&gt;</span><br><span class="line">        &lt;constructor-arg name=&quot;pool&quot; ref=&quot;fdfsConnectionPool&quot;&gt;</span><br><span class="line">        &lt;/constructor-arg&gt;</span><br><span class="line">        &lt;!--配置fastDFS tracker 服务器 ip:port 地址--&gt;</span><br><span class="line">        &lt;property name=&quot;trackerList&quot;&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;10.211.55.5:22122&lt;/value&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!--配置连接池--&gt;</span><br><span class="line">    &lt;bean id=&quot;fdfsConnectionPool&quot; class=&quot;com.github.tobato.fastdfs.conn.FdfsConnectionPool&quot;&gt;</span><br><span class="line">        &lt;!--注入连接池配置--&gt;</span><br><span class="line">        &lt;constructor-arg name=&quot;config&quot; &gt;</span><br><span class="line">            &lt;bean class=&quot;com.github.tobato.fastdfs.conn.ConnectionPoolConfig&quot;/&gt;</span><br><span class="line">        &lt;/constructor-arg&gt;</span><br><span class="line">        &lt;!--注入连接池工厂--&gt;</span><br><span class="line">        &lt;constructor-arg name=&quot;factory&quot; &gt;</span><br><span class="line">            &lt;bean class=&quot;com.github.tobato.fastdfs.conn.PooledConnectionFactory&quot;/&gt;</span><br><span class="line">        &lt;/constructor-arg&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p></li></ol><p>4.编写test类demo<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">package org.seckill;</span><br><span class="line"></span><br><span class="line">import com.github.tobato.fastdfs.domain.StorePath;</span><br><span class="line">import com.github.tobato.fastdfs.service.FastFileStorageClient;</span><br><span class="line">import org.junit.Test;</span><br><span class="line">import org.junit.runner.RunWith;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.test.context.ContextConfiguration;</span><br><span class="line">import org.springframework.test.context.junit4.AbstractJUnit4SpringContextTests;</span><br><span class="line">import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line"></span><br><span class="line">@ContextConfiguration(locations = &#123;&quot;classpath:spring/spring-fastdfs.xml&quot;&#125;)</span><br><span class="line">@RunWith(SpringJUnit4ClassRunner.class)</span><br><span class="line">public class FastDFSDemo extends AbstractJUnit4SpringContextTests &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger = LoggerFactory.getLogger(FastDFSDemo.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private FastFileStorageClient fastFileStorageClient;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *上传</span><br><span class="line">     *</span><br><span class="line">     * @author ❤ xiemao</span><br><span class="line">     * @date : 18/11/01 下午8:14</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void uploadFile() throws Exception &#123;</span><br><span class="line">        File file = new File(&quot;/Users/xie199475/备份/provider/src/main/resources/file_source/001.jpg&quot;);</span><br><span class="line">        StorePath storePath = fastFileStorageClient.</span><br><span class="line">                uploadFile(null, new FileInputStream(file), file.length(), &quot;jpg&quot;);</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;------:&#123;&#125;&quot;,storePath.getFullPath());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *删除</span><br><span class="line">     *</span><br><span class="line">     * @author ❤ xiemao</span><br><span class="line">     * @date : 18/11/01 下午8:15</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void delete()&#123;</span><br><span class="line">        String path = &quot;group1/M00/00/00/CtM3BlvUxfGAaC-fAAVFOL7FJU4.tar.gz&quot;;</span><br><span class="line">        fastFileStorageClient.deleteFile(path);</span><br><span class="line">        logger.info(&quot;----ok&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/upload&quot;, method = RequestMethod.POST)</span><br><span class="line">   public void upload(MultipartFile file, FileUpload fileUpload) throws IOException &#123;</span><br><span class="line">       StorePath storePath = fastFileStorageClient.</span><br><span class="line">               uploadFile(null, new ByteArrayInputStream(file.getBytes()), Long.valueOf(fileUpload.getSize()), &quot;jpg&quot;);</span><br><span class="line"></span><br><span class="line">       logger.info(&quot;------:&#123;&#125;&quot;, storePath.getFullPath());</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   @RequestMapping(value = &quot;/download&quot;, method = RequestMethod.POST)</span><br><span class="line">   public void download(HttpServletResponse response) throws Exception &#123;</span><br><span class="line">       try (OutputStream os = response.getOutputStream();</span><br><span class="line">            BufferedOutputStream bf = new BufferedOutputStream(os)) &#123;</span><br><span class="line">           String groupName = &quot;group1&quot;;</span><br><span class="line">           String path = &quot;M00/00/00/CtM3Blvj9PKAYquVAAD9K7ssbVE777.jpg&quot;;</span><br><span class="line">           byte[] data = fastFileStorageClient.downloadFile(groupName, path, new DownloadByteArray());</span><br><span class="line">           IOUtils.write(data, bf);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p><h2>配置文件参数说明</h2><p>storage.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">storage.conf配置文件分析：</span><br><span class="line"></span><br><span class="line">#同tracker.conf</span><br><span class="line">disabled=false</span><br><span class="line"> </span><br><span class="line">#这个storage服务器属于那个group</span><br><span class="line">group_name=group1</span><br><span class="line"> </span><br><span class="line">#同tracker.conf</span><br><span class="line">bind_addr=</span><br><span class="line"> </span><br><span class="line">#连接其他服务器时是否绑定地址，bind_addr配置时本参数才有效</span><br><span class="line">client_bind=true</span><br><span class="line"> </span><br><span class="line">#同tracker.conf</span><br><span class="line">port=23000</span><br><span class="line">connect_timeout=30</span><br><span class="line">network_timeout=60</span><br><span class="line"> </span><br><span class="line">#主动向tracker发送心跳检测的时间间隔</span><br><span class="line">heart_beat_interval=30</span><br><span class="line"> </span><br><span class="line">#主动向tracker发送磁盘使用率的时间间隔</span><br><span class="line">stat_report_interval=60</span><br><span class="line"> </span><br><span class="line">#同tracker.conf</span><br><span class="line">base_path=/opt/fdfs</span><br><span class="line">max_connections=256</span><br><span class="line"> </span><br><span class="line">#接收/发送数据的buff大小，必须大于8KB</span><br><span class="line">buff_size = 256KB</span><br><span class="line"> </span><br><span class="line">#同tracker.conf</span><br><span class="line">work_threads=4</span><br><span class="line"> </span><br><span class="line">#磁盘IO是否读写分离</span><br><span class="line">disk_rw_separated = true</span><br><span class="line"> </span><br><span class="line">#是否直接读写文件，默认关闭</span><br><span class="line">disk_rw_direct = false</span><br><span class="line"> </span><br><span class="line">#混合读写时的读写线程数</span><br><span class="line">disk_reader_threads = 1</span><br><span class="line">disk_writer_threads = 1</span><br><span class="line"> </span><br><span class="line">#同步文件时如果binlog没有要同步的文件，则延迟多少毫秒后重新读取，0表示不延迟</span><br><span class="line">sync_wait_msec=50</span><br><span class="line"> </span><br><span class="line">#同步完一个文件后间隔多少毫秒同步下一个文件，0表示不休息直接同步</span><br><span class="line">sync_interval=0</span><br><span class="line"> </span><br><span class="line">#表示这段时间内同步文件</span><br><span class="line">sync_start_time=00:00</span><br><span class="line">sync_end_time=23:59</span><br><span class="line"> </span><br><span class="line">#同步完多少文件后写mark标记</span><br><span class="line">write_mark_file_freq=500</span><br><span class="line"> </span><br><span class="line">#storage在存储文件时支持多路径，默认只设置一个</span><br><span class="line">store_path_count=1</span><br><span class="line"> </span><br><span class="line">#配置多个store_path路径，从0开始，如果store_path0不存在，则base_path必须存在</span><br><span class="line">store_path0=/opt/fdfs</span><br><span class="line">#store_path1=/opt/fastdfs2</span><br><span class="line"> </span><br><span class="line">#subdir_count  * subdir_count个目录会在store_path下创建，采用两级存储</span><br><span class="line">subdir_count_per_path=256</span><br><span class="line"> </span><br><span class="line">#设置tracker_server</span><br><span class="line">tracker_server=x.x.x.x:22122</span><br><span class="line"> </span><br><span class="line">#同tracker.conf</span><br><span class="line">log_level=info</span><br><span class="line">run_by_group=</span><br><span class="line">run_by_user=</span><br><span class="line">allow_hosts=*</span><br><span class="line"> </span><br><span class="line">#文件在数据目录下的存放策略，0:轮训 1:随机</span><br><span class="line">file_distribute_path_mode=0</span><br><span class="line"> </span><br><span class="line">#当问及是轮训存放时，一个目录下可存放的文件数目</span><br><span class="line">file_distribute_rotate_count=100</span><br><span class="line"> </span><br><span class="line">#写入多少字节后就开始同步，0表示不同步</span><br><span class="line">fsync_after_written_bytes=0</span><br><span class="line"> </span><br><span class="line">#刷新日志信息到disk的间隔</span><br><span class="line">sync_log_buff_interval=10</span><br><span class="line"> </span><br><span class="line">#同步storage的状态信息到disk的间隔</span><br><span class="line">sync_stat_file_interval=300</span><br><span class="line"> </span><br><span class="line">#线程栈大小</span><br><span class="line">thread_stack_size=512KB</span><br><span class="line"> </span><br><span class="line">#设置文件上传服务器的优先级，值越小越高</span><br><span class="line">upload_priority=10</span><br><span class="line"> </span><br><span class="line">#是否检测文件重复存在，1:检测 0:不检测</span><br><span class="line">check_file_duplicate=0</span><br><span class="line"> </span><br><span class="line">#当check_file_duplicate设置为1时，次值必须设置</span><br><span class="line">key_namespace=FastDFS</span><br><span class="line"> </span><br><span class="line">#与FastDHT建立连接的方式 0:短连接 1:长连接</span><br><span class="line">keep_alive=0</span><br><span class="line"> </span><br><span class="line">#同tracker.conf</span><br><span class="line">http.disabled=false</span><br><span class="line">http.domain_name=</span><br><span class="line">http.server_port=8888</span><br><span class="line">http.trunk_size=256KB</span><br><span class="line">http.need_find_content_type=true</span><br><span class="line">##include http.conf</span><br></pre></td></tr></table></figure></p><p>tracker.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">tracker.conf 配置文件分析：</span><br><span class="line"></span><br><span class="line">#配置tracker.conf这个配置文件是否生效，因为在启动fastdfs服务端进程时需要指定配置文件，所以需要使次配置文件生效。false是生效，true是屏蔽。</span><br><span class="line">disabled=false</span><br><span class="line"> </span><br><span class="line">#程序的监听地址，如果不设定则监听所有地址</span><br><span class="line">bind_addr=</span><br><span class="line"> </span><br><span class="line">#tracker监听的端口</span><br><span class="line">port=22122</span><br><span class="line"> </span><br><span class="line">#链接超时设定</span><br><span class="line">connect_timeout=30</span><br><span class="line"> </span><br><span class="line">#tracker在通过网络发送接收数据的超时时间</span><br><span class="line">network_timeout=60</span><br><span class="line"> </span><br><span class="line">#数据和日志的存放地点</span><br><span class="line">base_path=/opt/fdfs</span><br><span class="line"> </span><br><span class="line">#服务所支持的最大链接数</span><br><span class="line">max_connections=256</span><br><span class="line"> </span><br><span class="line">#工作线程数一般为cpu个数</span><br><span class="line">work_threads=4</span><br><span class="line"> </span><br><span class="line">#在存储文件时选择group的策略，0:轮训策略 1:指定某一个组 2:负载均衡，选择空闲空间最大的group</span><br><span class="line">store_lookup=2</span><br><span class="line"> </span><br><span class="line">#如果上面的store_lookup选择了1，则这里需要指定一个group</span><br><span class="line">#store_group=group2</span><br><span class="line"> </span><br><span class="line">#在group中的哪台storage做主storage，当一个文件上传到主storage后，就由这台机器同步文件到group内的其他storage上，0：轮训策略 1：根据ip地址排序，第一个 2:根据优先级排序，第一个</span><br><span class="line">store_server=0</span><br><span class="line"> </span><br><span class="line">#选择那个storage作为主下载服务器，0:轮训策略 1:主上传storage作为主下载服务器</span><br><span class="line">download_server=0</span><br><span class="line"> </span><br><span class="line">#选择文件上传到storage中的哪个(目录/挂载点),storage可以有多个存放文件的base path 0:轮训策略 2:负载均衡，选择空闲空间最大的</span><br><span class="line">store_path=0</span><br><span class="line"> </span><br><span class="line">#系统预留空间，当一个group中的任何storage的剩余空间小于定义的值，整个group就不能上传文件了</span><br><span class="line">reserved_storage_space = 4GB</span><br><span class="line"> </span><br><span class="line">#日志信息级别</span><br><span class="line">log_level=info</span><br><span class="line"> </span><br><span class="line">#进程以那个用户/用户组运行，不指定默认是当前用户</span><br><span class="line">run_by_group=</span><br><span class="line">run_by_user=</span><br><span class="line"> </span><br><span class="line">#允许那些机器连接tracker默认是所有机器</span><br><span class="line">allow_hosts=*</span><br><span class="line"> </span><br><span class="line">#设置日志信息刷新到disk的频率，默认10s</span><br><span class="line">sync_log_buff_interval = 10</span><br><span class="line"> </span><br><span class="line">#检测storage服务器的间隔时间，storage定期主动向tracker发送心跳，如果在指定的时间没收到信号，tracker人为storage故障，默认120s</span><br><span class="line">check_active_interval = 120</span><br><span class="line"> </span><br><span class="line">#线程栈的大小，最小64K</span><br><span class="line">thread_stack_size = 64KB</span><br><span class="line"> </span><br><span class="line">#storage的ip改变后服务端是否自动调整，storage进程重启时才自动调整</span><br><span class="line">storage_ip_changed_auto_adjust = true</span><br><span class="line"> </span><br><span class="line">#storage之间同步文件的最大延迟，默认1天</span><br><span class="line">storage_sync_file_max_delay = 86400</span><br><span class="line"> </span><br><span class="line">#同步一个文件所花费的最大时间</span><br><span class="line">storage_sync_file_max_time = 300</span><br><span class="line"> </span><br><span class="line">#是否用一个trunk文件存储多个小文件</span><br><span class="line">use_trunk_file = false</span><br><span class="line"> </span><br><span class="line">#最小的solt大小，应该小于4KB，默认256bytes</span><br><span class="line">slot_min_size = 256</span><br><span class="line"> </span><br><span class="line">#最大的solt大小，如果上传的文件小于默认值，则上传文件被放入trunk文件中</span><br><span class="line">slot_max_size = 16MB</span><br><span class="line"> </span><br><span class="line">#trunk文件的默认大小，应该大于4M</span><br><span class="line">trunk_file_size = 64MB</span><br><span class="line"> </span><br><span class="line">#http服务是否生效，默认不生效</span><br><span class="line">http.disabled=false</span><br><span class="line"> </span><br><span class="line">#http服务端口</span><br><span class="line">http.server_port=8080</span><br><span class="line"> </span><br><span class="line">#检测storage上http服务的时间间隔，&lt;=0表示不检测</span><br><span class="line">http.check_alive_interval=30</span><br><span class="line"> </span><br><span class="line">#检测storage上http服务时所用请求的类型，tcp只检测是否可以连接，http必须返回200</span><br><span class="line">http.check_alive_type=tcp</span><br><span class="line"> </span><br><span class="line">#通过url检测storage http服务状态</span><br><span class="line">http.check_alive_uri=/status.html</span><br><span class="line"> </span><br><span class="line">#if need find content type from file extension name</span><br><span class="line">http.need_find_content_type=true</span><br><span class="line"> </span><br><span class="line">#用include包含进http的其他设置</span><br><span class="line">##include http.conf</span><br></pre></td></tr></table></figure></p><p>over~ :)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1&gt;Fastdfs分布式文件存储&lt;/h1&gt;
&lt;hr&gt;
&lt;h2&gt;简介&lt;/h2&gt;
&lt;p&gt;     Fastdfs是一款比较轻量级的开源分布式文件系统，作者是余庆大大在0几年业余时间用c撸出来的(工作不饱和，加班不够啊:)  ，现任淘宝网开放平台技术部资深架构师,Fastdfs在小
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>dubbo</title>
    <link href="http://yoursite.com/2018/11/10/dubbo/"/>
    <id>http://yoursite.com/2018/11/10/dubbo/</id>
    <published>2018-11-09T17:55:48.000Z</published>
    <updated>2018-11-09T17:55:48.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>rocketmq</title>
    <link href="http://yoursite.com/2018/11/10/rocketmq/"/>
    <id>http://yoursite.com/2018/11/10/rocketmq/</id>
    <published>2018-11-09T17:55:42.000Z</published>
    <updated>2018-11-09T17:55:42.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>spark</title>
    <link href="http://yoursite.com/2018/11/10/spark/"/>
    <id>http://yoursite.com/2018/11/10/spark/</id>
    <published>2018-11-09T17:55:19.000Z</published>
    <updated>2018-11-09T17:55:19.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>fastdfs</title>
    <link href="http://yoursite.com/2018/11/10/fastdfs/"/>
    <id>http://yoursite.com/2018/11/10/fastdfs/</id>
    <published>2018-11-09T17:55:08.000Z</published>
    <updated>2018-11-09T17:55:08.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Kafka</title>
    <link href="http://yoursite.com/2018/11/10/Kafka/"/>
    <id>http://yoursite.com/2018/11/10/Kafka/</id>
    <published>2018-11-09T17:54:53.000Z</published>
    <updated>2018-11-09T17:54:53.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>ELK</title>
    <link href="http://yoursite.com/2018/11/10/ELK/"/>
    <id>http://yoursite.com/2018/11/10/ELK/</id>
    <published>2018-11-09T17:54:22.000Z</published>
    <updated>2018-11-09T17:54:22.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>redis</title>
    <link href="http://yoursite.com/2018/11/10/redis/"/>
    <id>http://yoursite.com/2018/11/10/redis/</id>
    <published>2018-11-09T17:54:14.000Z</published>
    <updated>2018-11-09T17:54:14.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Elasticsearch</title>
    <link href="http://yoursite.com/2018/11/10/Elasticsearch/"/>
    <id>http://yoursite.com/2018/11/10/Elasticsearch/</id>
    <published>2018-11-09T17:54:06.000Z</published>
    <updated>2018-11-09T17:54:06.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>test2</title>
    <link href="http://yoursite.com/2018/11/10/test2/"/>
    <id>http://yoursite.com/2018/11/10/test2/</id>
    <published>2018-11-09T17:23:04.000Z</published>
    <updated>2018-11-09T17:23:04.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>test1</title>
    <link href="http://yoursite.com/2018/11/10/test1/"/>
    <id>http://yoursite.com/2018/11/10/test1/</id>
    <published>2018-11-09T17:23:00.000Z</published>
    <updated>2018-11-09T17:23:00.000Z</updated>
    
    <summary type="html">
    
    </summary>
    
    
  </entry>
  
</feed>
